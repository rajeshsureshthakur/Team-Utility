@echo off
setlocal enabledelayedexpansion

:: Step 1: Set base directory to "RESULTS" one level above current script folder
set "baseDir=%~dp0..\RESULTS"

:: Step 2: Normalize path
pushd "%baseDir%" >nul 2>&1
if errorlevel 1 (
    echo Creating RESULTS directory...
    mkdir "%baseDir%"
)
popd

:: Step 3: Get current date in MMDD format
for /f "tokens=2 delims==." %%A in ('"wmic os get localdatetime /value"') do set "dt=%%A"
set "today=%dt:~4,2%%dt:~6,2%"

:: Step 4: Find next available folder name
set "counter=1"
:checkFolder
set "folderName=RESULTS_%today%_!counter!"
if exist "%baseDir%\!folderName!" (
    set /a counter+=1
    goto :checkFolder
)

:: Step 5: Create final folder and subdirectories
set "fullPath=%baseDir%\!folderName!"
mkdir "!fullPath!\Input_Files"
mkdir "!fullPath!\Output_Files"
mkdir "!fullPath!\Test_Files"

echo âœ… Created: !folderName!
echo ðŸ“‚ With subfolders:
echo     - Input_Files
echo     - Output_Files
echo     - Test_Files

:: Optional: Open the folder
:: explorer "!fullPath!"

endlocal
exit /b 0
